### Настройка управления остатками

Данная опция позволяет управлять остатками на стороне CRM. Для активации необходимо поставить галочку. Информация по остаткам из CRM в WooCommerce обновляется **раз в 15 минут**.

Обратите внимание, для того чтобы вести остатки в CRM, требуется в настройках системы указать магазину "Вести каталог в системе", присвоить ему склад и включить редактирование остатков, а на стороне WooCommerce в настройках модуля активировать опцию "Синхронизация остатков".

Анализ работы по списанию остатков был произведен  в задаче [#75178](https://redmine.retailcrm.tech/issues/75178).

#### На стороне WooCommerce
Если остатки **ведут на сайте**, то в этом случае, при оформлении заказа на сайте, остаток по товару сразу же списывается в WooCommerce. В CRM обновление остатков по товарам происходит в момент синхронизации ICML-файла каталога *(~ 4 часа)*.
| Кейс | Результат |
|--|--|
| Оформить заказ на сайте, после указать статус Отменен заказу на стороне WooCommerce | При оформлении заказа остатки сразу списываются, как в WooCommerce, так и в CRM; <br/> После указания отмены заказу, в WooCommerce остатки сразу возвращаются, в CRM, если настроена автоматическая отмена товара при отмене заказа, остатки возвращаются, иначе нужно ждать обновления каталога |
| Оформить заказ в CRM, после указать статус из группы Выполнен в CRM | В CRM по товарам остатки не списываются; <br/> В WooCommerce остаток по товару списывается, когда приходит статус Выполнен |
| Оформить заказ в CRM, после указать статус из группы Отмена в CRM | В CRM остатки не списываются *(в т.ч. и при установлении отмены статусу товара)*, в WooCommerce остатки по товару также не возвращаются |

#### На стороне CRM
При ведении стока **на стороне CRM**, остаток по товару сразу списывается в CRM. На стороне WooCommerce остатки по товарам обновляются **раз в 15 минут**.
| Кейс | Результат |
|--|--|
| Оформить заказ в CRM, после указать статус в CRM, соответствующий в маппинге статусу Отмены заказа | Если данный статус в CRM не выставляет автоматически статус отмены товару, то в CRM остатки не возвращаются, также, как и на стороне WooCommerce <br/> Если будет выставлен статус отмены товару, остатки возвратятся в CRM и спустя 15 минут в WooCommerce |
| Оформить заказ в CRM, после указать в CRM **статус товару** из группы Отмена | В CRM остаток по товару возвращается, в WooCommerce сток обновляется через 15 минут |
| Оформить заказ на сайте в WooCommerce | Заказ выгружается в CRM, по нему списываются остатки по товару, данное списание передается на сторону WooCommerce |
| Оформить заказ на сайте в WooCommerce, после указать статус Отменен в админке сайта WooCommerce | В CRM приходит статус отмены заказа, если в CRM настроена опция автоматической отмены товара при отмене заказа, то остатки возвращаются в CRM, спустя время и в WooCommerce |
